<html>     
    <head>     
        <meta name="viewport" content="width=device-width" />   
	<script src="https://code.jquery.com/jquery-1.8.3.min.js"></script>
    </head>     
    <body  onload="checkOS()">
            <p id="demo">???</p>        
            
    </body>

        <script type="text/javascript">  
//             window.onload=function(){  
//                 // 通过iframe的方式试图打开APP，如果能正常打开，会直接切换到APP，并自动阻止a标签的默认行为  
//                 // 否则延迟两秒打开 url 
//                 if(isWeiXin()){ 
//                     document.getElementById("demo").innerHTML="weixin";
//                     var ifr = document.createElement('iframe');
//                     ifr.src = 'smartvus://';
//                     ifr.style.display = 'none';
//                     document.body.appendChild(ifr);
//                 } else{
//                     document.getElementById("demo").innerHTML="safari";
//                     window.location.href = "smartvus://";
//                 }
//                 window.setTimeout(function(){
//                                  window.location.href = "http://192.168.1.105/jump.php?ssid=sv-1%20cmbgca001?pwd=wmpbgca001";//打开app下载地址，有app同事提供
//                              },3000)
//             }; 
//             function isWeiXin(){ 
//                     var ua = window.navigator.userAgent.toLowerCase(); 
//                     if(ua.match(/MicroMessenger/i) == 'micromessenger'){ 
//                         return true; 
//                     }else{ 
//                         return false; 
//                     }
//              }
            function checkOS(){
			//正则,忽略大小写
		    var pattern_phone = new RegExp("iphone","i");
		    var pattern_android = new RegExp("android","i");
		    var pattern_ipad = new RegExp("ipad","i");
		    var pattern_mobile = new RegExp("mobile","i");
		    var userAgent = navigator.userAgent.toLowerCase();
		    var isAndroid = pattern_android.test(userAgent);
		    var isIphone = pattern_phone.test(userAgent);
		    var isIpad = pattern_ipad.test(userAgent);
		    var isMobile = pattern_mobile.test(userAgent);
		    var phoneType="phoneType";

		    var os;
		    var platform;
		    if(isAndroid){ 
			os = 'Android';
			if(isMobile){
			    phoneType = "Android Phone";
			    platform = 'phone'
			}else{
			    phoneType = "Android Pad";
			    platform = 'pad'
			}
		    }else if(isIphone){ 
			os = 'iOS'
			platform = 'phone'
			phoneType = "iPhone";
		    }else if(isIpad){
			os = 'iOS'
			platform = 'pad'
			phoneType = "iPad";
		    }else{
			os = 'unknow';
			phoneType = "unknow";
		    }
		    var str = "pc";
		    if(isMobile){
			str = "mobile"
		    }

		    var currentUrl = window.location.href;
		    var probe = "probe";
		    c_start=currentUrl.indexOf(probe+"=")
		    if(c_start!=-1){
			c_start = c_start + probe.length+1;
			c_end = currentUrl.indexOf(";",c_start)
			if(c_end==-1) c_end = currentUrl.length
			probe = unescape(currentUrl.substring(c_start,c_end))
		    }

		    $.ajax({
			url:'https://www.smartvus.com/package/package.php',
			method:'get',
			data:{
			    os:os,
			    platform:platform,
			    probe:probe
			},
			dataType:'json',
			success: function(msg){
			   // var j = JSON.decode(msg);
			var j = msg;
			    if(!j) return false;
			    if(j.url){
				window.location.href = j.url;
				document.getElementById("url").innerHTML = j.url;
			    }
			},
			error:function(msg){
			  document.getElementById("url").innerHTML = msg;
			}
		    });

		    // 是微信内部webView
		    if (is_weixn()) {
			alert("请点击右上角按钮, 点击使用浏览器打开");
		    }

		   // 是微信浏览器
			function is_weixn(){
				var ua = navigator.userAgent.toLowerCase();
				if(ua.match(/MicroMessenger/i)=="micromessenger") {
				    return true;
				} else {
				    return false;
				}
			}
	}
         </script>    
</html>  
